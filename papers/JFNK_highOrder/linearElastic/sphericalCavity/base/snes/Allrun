#!/bin/bash

# Source tutorial run functions
. $WM_PROJECT_DIR/bin/tools/RunFunctions

# Source solids4Foam scripts
source solids4FoamScripts.sh

solids4Foam::caseDoesNotRunWithFoamExtend
solids4Foam::caseDoesNotRunWithOpenFOAMOrg

# Use poly (1) or tet (0) volumes
USE_POLY=0

# Create the mesh
if command -v gmsh &> /dev/null
then
    # Remporarily rename 0 to avoid issues
    mv 0 0.tmp

    # Create mesh with gmsh
    if [ "$USE_POLY" -eq 1 ]
    then
        solids4Foam::runApplication gmsh -3 -format msh2 gmsh/poly.geo
        solids4Foam::runApplication gmshToFoam gmsh/poly.msh
        solids4Foam::runApplication polyDualMesh 30 -overwrite
        solids4Foam::runApplication combinePatchFaces 45 -overwrite
    else
        solids4Foam::runApplication gmsh -3 -format msh2 gmsh/tet.geo
        solids4Foam::runApplication gmshToFoam gmsh/tet.msh
    fi
    solids4Foam::runApplication changeDictionary
    solids4Foam::runApplication projectPointsToSphere cavity "(0 0 0)" 0.2 -overwrite
    rm -rf 0

    # Move 0 back
    mv 0.tmp 0
else
    # Fail silently
    echo; echo "Gmsh is required to run this case: please install it"
    exit 0
fi

# Run solver
solids4Foam::runApplication solids4Foam
